import numpy as np
import matplotlib.pyplot as plt
import matplotlib.ticker as mticker

data = np.array([
-0.43791088,0.015424371,0.205009961,0.328669241,0.580113728,0.622028258,1.200959279,0.620387637,-0.425739805,-2.326649106,
-0.645905802,4.759883779,0.910942504,-0.085177141,3.59865577,0.06929856,0.33415833,-1.717972696,0.445267349,0.335645203,
-2.311964785,-0.294883159,-1.824859147,-1.000054196,-3.407061594,0.603150181,-1.138889768,-0.282127174,3.061632909,16.04980526,
26.37315992,-1.453309518,0.602853714,3.633399459,-5.419776347,-5.40602059,-0.185821537,1.010560468,1.585881716,-1.59698952,
0.229332801,-0.056944992,0.572841822,1.254176256,-0.231088736,1.787756945,3.448506045,1.517247269,-8.068827199,-1.73738935,
0.338974645,-7.495756052,-7.299330331,0.248932168,3.048035852,0.191987958,-1.868177197,0.966206644,-1.910216404,-1.667245149,
0.368684835,0.298999082,-0.422248561,0.222784252,0.250304284,1.197915482,0.401908096,-24.82477604,0.421162605,1.720944108,
0.393871902,-1.228589998,0.303832387,-0.792127386,-0.30520299,-0.304114709,5.396708342,0.273533733,0.205829316,0.350769158,
2.480620834,0.219997428,0.911020605,-0.376090105,21.82591037,-0.366571075,8.344331896,0.773753859,2.270781121,1.599020387,
0.64963724,6.815354107,7.821697935,1.167163692,0.917044413,-3.661745418,0.637710724,0.248653462,0.99382666,1.432529574,
0.238657334,-88.22214249,-1.202386552,17.09707952,0.572888355,0.357004233,0.515862704,0.209451954,2.778744761,-3.36884988,
1.289405558,1.665897451,1.587193902,-2.974968536,0.34952835,-18.37050619,-3.10711348,-3.759570892,0.549433865,1.506812912,
0.2283177,3.434337098,0.296672115,-0.15829881,-0.8527508,0.367628078,23.47788264,3.833704808,-5.874217965,12.36706286,
0.258192839,-2.047099037,0.81150667,-51.56914649,1.014566234,4.426598252,0.409032415,0.169973024,0.216723496,0.520573644,
1.621675187,2.164475909,0.369881635,-1.29210704,0.60771175,0.538402081,2.179774552,-0.545288321,1.243534145,5.754390963
])

def annotated_hist(ax, x, bins, rng=None, title='Histogram'):
    ax.hist(x, bins=bins, range=rng, color='#4e79a7', edgecolor='white', alpha=0.9)
    mean = np.mean(x)
    median = np.median(x)
    ax.axvline(mean, color='#e15759', linestyle='--', linewidth=1.8, label=f'Mean: {mean:.2f}')
    ax.axvline(median, color='#76b7b2', linestyle='-.', linewidth=1.8, label=f'Median: {median:.2f}')
    ax.set_title(title)
    ax.set_xlabel('pnl_pct (%)')
    ax.set_ylabel('Frequency')
    ax.legend()
    ax.grid(True, axis='y', linestyle=':', alpha=0.4)

fig, axes = plt.subplots(1, 2, figsize=(13, 4.2), constrained_layout=True)

# 子图1：全量，更密的桶
annotated_hist(axes[0], data, bins=100, rng=None, title='Histogram (All Data, bins=100)')

# 子图2：截尾，更高分辨率
mask = (data >= -10) & (data <= 15)
annotated_hist(axes[1], data[mask], bins=200, rng=[-10, 15], title='Histogram (-10 to 15, bins=200)')

# 让第二个子图横轴更好读：主刻度1，副刻度0.2
axes[1].xaxis.set_major_locator(mticker.MultipleLocator(1))
axes[1].xaxis.set_minor_locator(mticker.MultipleLocator(0.2))
axes[1].grid(True, which='minor', axis='x', linestyle=':', alpha=0.25)

plt.show()
